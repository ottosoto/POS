function getLineheight(e){var t;if(e.css("line-height")=="normal"){t=e.css("font-size")}else{t=e.css("line-height")}return parseInt(t.replace("px",""))}function getTextAlign(e){var t=e.css("text-align");if(t=="-webkit-auto"){t="left"}return t}function printAtWordWrap(e,t,n,r,i,s){var o=[];i=i||0;if(i<=0){o.push(t)}var u=t.split(" ");var a=1;while(u.length>0&&a<=u.length){var f=u.slice(0,a).join(" ");var l=e.measureText(f).width;if(l>i){if(a==1){a=2}o.push(u.slice(0,a-1).join(" "));u=u.splice(a-1);a=1}else{a++}}if(u.length&&a>0){o.push(u.join(" "))}if(e.textAlign=="center"){n+=i/2}if(e.textBaseline=="middle"){r-=s/2}else if(e.textBaseline=="top"){r-=s}for(a=o.length-1;a>=0;a--){var c=o.pop();if(e.measureText(c).width>i&&e.textAlign=="center"){n-=i/2;e.textAlign="left";e.fillText(c,n,r+(a+1)*s);e.textAlign="center";n+=i/2}else{e.fillText(c,n,r+(a+1)*s)}}}function findPlotSize(e){var t=e.width();var n=e.height();var r=e.find(".jqplot-table-legend");if(r.position()){n=r.position().top+r.height()}e.find("*").each(function(){var e=$(this).offset();tempWidth=e.left+$(this).width();tempHeight=$(this).height();if(tempWidth>t){t=tempWidth}if(tempHeight>n){n=tempHeight}});return{width:t,height:n}}function jqplotToImg(e){var t=document.createElement("canvas");var n=findPlotSize(e);t.width=n.width;t.height=n.height;var r=e.offset();if(e.find("canvas.jqplot-base-canvas").length){r=e.find("canvas.jqplot-base-canvas").offset();r.left-=parseInt(e.css("margin-left").replace("px",""))}var i=t.getContext("2d");var s="rgba(255,255,255,1)";e.children(":first-child").parents().each(function(){if($(this).css("background-color")!="transparent"){s=$(this).css("background-color");return false}});i.fillStyle=s;i.fillRect(0,0,t.width,t.height);e.find("canvas").each(function(){var e=$(this).offset();t.getContext("2d").drawImage(this,e.left-r.left,e.top-r.top)});e.find(".jqplot-series-canvas > div").each(function(){var e=$(this).offset();var n=t.getContext("2d");n.fillStyle=$(this).css("background-color");n.fillRect(e.left-r.left-parseInt($(this).css("padding-left").replace("px","")),e.top-r.top,$(this).width()+parseInt($(this).css("padding-left").replace("px",""))+parseInt($(this).css("padding-right").replace("px","")),$(this).height()+parseInt($(this).css("padding-top").replace("px",""))+parseInt($(this).css("padding-bottom").replace("px","")));n.font=[$(this).css("font-style"),$(this).css("font-size"),$(this).css("font-family")].join(" ");n.fillStyle=$(this).css("color");n.textAlign=getTextAlign($(this));var i=$.trim($(this).html()).replace(/<br style="">/g," ");var s=getLineheight($(this));printAtWordWrap(n,i,e.left-r.left,e.top-r.top-parseInt($(this).css("padding-top").replace("px","")),$(this).width(),s)});e.find("div.jqplot-axis > div, div.jqplot-point-label, div.jqplot-error-message, .jqplot-data-label, div.jqplot-meterGauge-tick, div.jqplot-meterGauge-label").each(function(){var e=$(this).offset();var n=t.getContext("2d");n.font=[$(this).css("font-style"),$(this).css("font-size"),$(this).css("font-family")].join(" ");n.fillStyle=$(this).css("color");var i=$.trim($(this).text());var s=getLineheight($(this));printAtWordWrap(n,i,e.left-r.left,e.top-r.top-2.5,$(this).width(),s)});e.children("div.jqplot-title").each(function(){var n=$(this).offset();var i=t.getContext("2d");i.font=[$(this).css("font-style"),$(this).css("font-size"),$(this).css("font-family")].join(" ");i.textAlign=getTextAlign($(this));i.fillStyle=$(this).css("color");var s=$.trim($(this).text());var o=getLineheight($(this));printAtWordWrap(i,s,n.left-r.left,n.top-r.top,t.width-parseInt(e.css("margin-left").replace("px",""))-parseInt(e.css("margin-right").replace("px","")),o)});e.children("table.jqplot-table-legend").each(function(){var e=$(this).offset();var n=t.getContext("2d");n.strokeStyle=$(this).css("border-top-color");n.strokeRect(e.left-r.left,e.top-r.top,$(this).width(),$(this).height());n.fillStyle=$(this).css("background-color");n.fillRect(e.left-r.left,e.top-r.top,$(this).width(),$(this).height())});e.find("div.jqplot-table-legend-swatch").each(function(){var e=$(this).offset();var n=t.getContext("2d");n.fillStyle=$(this).css("border-top-color");n.fillRect(e.left-r.left,e.top-r.top,$(this).parent().width(),$(this).parent().height())});e.find("td.jqplot-table-legend").each(function(){var e=$(this).offset();var n=t.getContext("2d");n.font=[$(this).css("font-style"),$(this).css("font-size"),$(this).css("font-family")].join(" ");n.fillStyle=$(this).css("color");n.textAlign=getTextAlign($(this));n.textBaseline=$(this).css("vertical-align");var i=$.trim($(this).text());var s=getLineheight($(this));printAtWordWrap(n,i,e.left-r.left,e.top-r.top+parseInt($(this).css("padding-top").replace("px","")),$(this).width(),s)});return t.toDataURL("image/png")}